# Family App - ì±„íŒ…ë°© ê°œì„  ê³„íš

> **ëª©í‘œ**: ì™“ì¸ ì•±/ì¹´ì¹´ì˜¤í†¡/ë©”ì‹ ì € ìˆ˜ì¤€ì˜ ì±„íŒ… UX êµ¬í˜„
> **ì‘ì„±ì¼**: 2026-01-08

---

## ğŸ“‹ í˜„ì¬ êµ¬í˜„ ìƒíƒœ

### âœ… ì™„ë£Œëœ ê¸°ëŠ¥
- Socket.IO ì‹¤ì‹œê°„ ë©”ì‹œì§€ ì „ì†¡/ìˆ˜ì‹ 
- íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°
- ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ìƒíƒœ í‘œì‹œ
- ì´ë¯¸ì§€/ë™ì˜ìƒ ì²¨ë¶€ (Cloudinary)
- ë©”ì‹œì§€ ì‚­ì œ (ë³¸ì¸ ë©”ì‹œì§€ë§Œ)
- íƒ€ì„ìŠ¤íƒ¬í”„ í‘œì‹œ
- ì• ë‹ˆë©”ì´ì…˜ (fade-in, slide-in)
- ë‚ ì§œ êµ¬ë¶„ì„ 
- ë‹µì¥/ì¸ìš©
- ë©”ì‹œì§€ ì „ì†¡ ìƒíƒœ í‘œì‹œ
- ì½ìŒ í‘œì‹œ
- ì´ëª¨ì§€ ë¦¬ì•¡ì…˜
- ë©”ì‹œì§€ ìˆ˜ì • (5ë¶„ ì œí•œ)
- ë¯¸ë””ì–´ ê°¤ëŸ¬ë¦¬
- ë©”ì‹œì§€ ê²€ìƒ‰

### âœ… í•´ê²°ëœ ë¬¸ì œì 
1. ë‚ ì§œ êµ¬ë¶„ ì—†ìŒ â†’ ë‚ ì§œ êµ¬ë¶„ì„  ì¶”ê°€
2. ë‹µì¥ ë¶ˆê°€ â†’ ë‹µì¥/ì¸ìš© ê¸°ëŠ¥ ì¶”ê°€
3. ì½ìŒ í‘œì‹œ ì—†ìŒ â†’ ì½ìŒ í‘œì‹œ ì¶”ê°€
4. ì´ëª¨ì§€ ë¦¬ì•¡ì…˜ ì—†ìŒ â†’ ë¦¬ì•¡ì…˜ ì¶”ê°€
5. ë™ì˜ìƒ ì²¨ë¶€ ë¶ˆê°€ â†’ ë™ì˜ìƒ ì²¨ë¶€ ì§€ì›
6. ì „ì†¡ ìƒíƒœ í”¼ë“œë°± ë¶€ì¡± â†’ ì „ì†¡ ìƒíƒœ í‘œì‹œ

---

## ğŸ¯ ê°œì„  ê³„íš

### Phase 1: í•„ìˆ˜ UX ê°œì„  (ìš°ì„ ìˆœìœ„ ë†’ìŒ)

#### 1. ë‚ ì§œ êµ¬ë¶„ì„  â­â­â­
**ì˜ˆìƒ ì‹œê°„**: 30ë¶„
**DB ë³€ê²½**: ì—†ìŒ (í”„ë¡ íŠ¸ì—”ë“œë§Œ)

**êµ¬í˜„ ë‚´ìš©:**
```tsx
// ë‚ ì§œ êµ¬ë¶„ì„  ì»´í¬ë„ŒíŠ¸
<DateSeparator>
  ì–´ì œ / ì˜¤ëŠ˜ / 2026ë…„ 1ì›” 8ì¼
</DateSeparator>
```

**êµ¬í˜„ ìœ„ì¹˜:**
- `components/chat/date-separator.tsx` (ì‹ ê·œ)
- `components/chat/message-list.tsx` (ìˆ˜ì •)

**ë¡œì§:**
- ë©”ì‹œì§€ ë Œë”ë§ ì‹œ ì´ì „ ë©”ì‹œì§€ì™€ ë‚ ì§œ ë¹„êµ
- ë‚ ì§œê°€ ë‹¤ë¥´ë©´ êµ¬ë¶„ì„  í‘œì‹œ
- date-fns ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©

---

#### 2. ë‹µì¥/ì¸ìš© ê¸°ëŠ¥ â­â­â­
**ì˜ˆìƒ ì‹œê°„**: 1.5ì‹œê°„
**DB ë³€ê²½**: ìˆìŒ

**DB ìŠ¤í‚¤ë§ˆ ì¶”ê°€:**
```prisma
model ChatMessage {
  // ê¸°ì¡´ í•„ë“œë“¤...
  replyToId String?

  replyTo  ChatMessage?  @relation("MessageReplies", fields: [replyToId], references: [id], onDelete: SetNull)
  replies  ChatMessage[] @relation("MessageReplies")
}
```

**êµ¬í˜„ ë‚´ìš©:**
1. ë©”ì‹œì§€ ê¸¸ê²Œ ëˆ„ë¥´ê¸° â†’ "ë‹µì¥" ë©”ë‰´
2. ë‹µì¥í•  ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
3. ë‹µì¥ ë©”ì‹œì§€ì— ì›ë³¸ ë©”ì‹œì§€ ì¸ìš© í‘œì‹œ
4. ì¸ìš© ë©”ì‹œì§€ í´ë¦­ â†’ ì›ë³¸ ë©”ì‹œì§€ë¡œ ìŠ¤í¬ë¡¤

**êµ¬í˜„ ìœ„ì¹˜:**
- `prisma/schema.prisma` (ìˆ˜ì •)
- `components/chat/message-item.tsx` (ìˆ˜ì •)
- `components/chat/message-input.tsx` (ìˆ˜ì •)
- `components/chat/reply-preview.tsx` (ì‹ ê·œ)
- `app/api/chat/rooms/[roomId]/messages/route.ts` (ìˆ˜ì •)

---

#### 3. ë©”ì‹œì§€ ìƒíƒœ í‘œì‹œ â­â­
**ì˜ˆìƒ ì‹œê°„**: 1ì‹œê°„
**DB ë³€ê²½**: ì—†ìŒ (Optimistic Update)

**êµ¬í˜„ ë‚´ìš©:**
```tsx
// ë©”ì‹œì§€ ìƒíƒœ ì•„ì´ì½˜
â±ï¸ ì „ì†¡ ì¤‘
âœ“ ì „ì†¡ ì™„ë£Œ
âš ï¸ ì „ì†¡ ì‹¤íŒ¨ (ì¬ì „ì†¡ ë²„íŠ¼)
```

**êµ¬í˜„ ìœ„ì¹˜:**
- `components/chat/message-item.tsx` (ìˆ˜ì •)
- `components/chat/message-input.tsx` (ìˆ˜ì •)
- `lib/hooks/use-chat.ts` (ìˆ˜ì • - Optimistic Update)

**ê¸°ìˆ :**
- TanStack Queryì˜ `onMutate` (ë‚™ê´€ì  ì—…ë°ì´íŠ¸)
- Socket.IO ì‘ë‹µìœ¼ë¡œ ì „ì†¡ í™•ì¸
- ë¡œì»¬ ìƒíƒœë¡œ ì „ì†¡ ìƒíƒœ ê´€ë¦¬

---

### Phase 2: ê³ ê¸‰ ê¸°ëŠ¥ (ìš°ì„ ìˆœìœ„ ì¤‘ê°„)

#### 4. ì½ìŒ í‘œì‹œ (ì¹´ì¹´ì˜¤í†¡ "1") â­â­â­
**ì˜ˆìƒ ì‹œê°„**: 1.5ì‹œê°„
**DB ë³€ê²½**: ìˆìŒ

**DB ìŠ¤í‚¤ë§ˆ ì¶”ê°€:**
```prisma
model MessageRead {
  id        String   @id @default(cuid())
  messageId String
  readerId  String
  readAt    DateTime @default(now())

  message ChatMessage   @relation(fields: [messageId], references: [id], onDelete: Cascade)
  reader  FamilyMember  @relation(fields: [readerId], references: [id], onDelete: Cascade)

  @@unique([messageId, readerId])
  @@index([messageId])
  @@index([readerId])
  @@map("message_reads")
}
```

**êµ¬í˜„ ë‚´ìš©:**
1. ë©”ì‹œì§€ ë·°í¬íŠ¸ ì§„ì… ì‹œ ì½ìŒ ì²˜ë¦¬
2. Socket.IOë¡œ ì‹¤ì‹œê°„ ì½ìŒ ìƒíƒœ ì „íŒŒ
3. ì½ì§€ ì•Šì€ ì‚¬ëŒ ìˆ˜ í‘œì‹œ ("1", "2", ...)
4. ëª¨ë‘ ì½ìœ¼ë©´ í‘œì‹œ ì•ˆ í•¨

**êµ¬í˜„ ìœ„ì¹˜:**
- `prisma/schema.prisma` (ìˆ˜ì •)
- `app/api/chat/messages/[messageId]/read/route.ts` (ì‹ ê·œ)
- `components/chat/message-item.tsx` (ìˆ˜ì •)
- Socket.IO ì„œë²„ (ìˆ˜ì • - `message-read` ì´ë²¤íŠ¸)

---

#### 5. ì´ëª¨ì§€ ë¦¬ì•¡ì…˜ â­â­
**ì˜ˆìƒ ì‹œê°„**: 1.5ì‹œê°„
**DB ë³€ê²½**: ìˆìŒ

**DB ìŠ¤í‚¤ë§ˆ ì¶”ê°€:**
```prisma
model MessageReaction {
  id        String   @id @default(cuid())
  messageId String
  userId    String
  emoji     String   @db.VarChar(10)
  createdAt DateTime @default(now())

  message ChatMessage   @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user    FamilyMember  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId, emoji])
  @@index([messageId])
  @@map("message_reactions")
}
```

**êµ¬í˜„ ë‚´ìš©:**
1. ë©”ì‹œì§€ì— ì´ëª¨ì§€ ë¦¬ì•¡ì…˜ ë²„íŠ¼
2. ìì£¼ ì“°ëŠ” ì´ëª¨ì§€ ì„ íƒ UI (ğŸ‘ â¤ï¸ ğŸ˜‚ ğŸ˜® ğŸ˜¢ ğŸ™)
3. ê°™ì€ ì´ëª¨ì§€ ì¬í´ë¦­ ì‹œ ë¦¬ì•¡ì…˜ ì·¨ì†Œ
4. ë¦¬ì•¡ì…˜ ê°œìˆ˜ í‘œì‹œ
5. ë¦¬ì•¡ì…˜í•œ ì‚¬ëŒ ëª©ë¡ í‘œì‹œ

**êµ¬í˜„ ìœ„ì¹˜:**
- `prisma/schema.prisma` (ìˆ˜ì •)
- `app/api/chat/messages/[messageId]/reactions/route.ts` (ì‹ ê·œ)
- `components/chat/message-item.tsx` (ìˆ˜ì •)
- `components/chat/emoji-picker.tsx` (ì‹ ê·œ)
- Socket.IO ì„œë²„ (ìˆ˜ì •)

---

#### 6. ë™ì˜ìƒ + ì—¬ëŸ¬ íŒŒì¼ ì²¨ë¶€ â­â­
**ì˜ˆìƒ ì‹œê°„**: 2ì‹œê°„
**DB ë³€ê²½**: ìˆìŒ

**DB ìŠ¤í‚¤ë§ˆ ìˆ˜ì •:**
```prisma
model ChatMessage {
  // imageUrl ì œê±°
  mediaUrls  String[]  @default([])  // ì—¬ëŸ¬ ë¯¸ë””ì–´ URL
  mediaTypes String[]  @default([])  // ["image", "video", "image"]
}
```

**êµ¬í˜„ ë‚´ìš©:**
1. Cloudinary Widget ì‚¬ìš© (í´ë¼ì´ì–¸íŠ¸ ì§ì ‘ ì—…ë¡œë“œ)
2. ì´ë¯¸ì§€ + ë™ì˜ìƒ ë™ì‹œ ì„ íƒ ê°€ëŠ¥ (ìµœëŒ€ 10ê°œ)
3. íŒŒì¼ í¬ê¸° ì œí•œ 100MB (Cloudinary)
4. í”„ë¦¬ë·° í‘œì‹œ (ì¸ë„¤ì¼ ê·¸ë¦¬ë“œ)
5. ë™ì˜ìƒ ì¬ìƒ UI

**êµ¬í˜„ ìœ„ì¹˜:**
- `prisma/schema.prisma` (ìˆ˜ì •)
- `components/ui/media-upload.tsx` (ì‹ ê·œ - Widget)
- `components/chat/message-input.tsx` (ìˆ˜ì •)
- `components/chat/message-item.tsx` (ìˆ˜ì • - ë¯¸ë””ì–´ ê·¸ë¦¬ë“œ)
- `app/api/chat/rooms/[roomId]/messages/route.ts` (ìˆ˜ì •)

**ì¶”ê°€ ì„¤ì •:**
- Cloudinary Unsigned Upload Preset ìƒì„±
- í™˜ê²½ë³€ìˆ˜ `NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME`
- í™˜ê²½ë³€ìˆ˜ `NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET`

---

### Phase 3: ì„ íƒ ê¸°ëŠ¥ (ìš°ì„ ìˆœìœ„ ë‚®ìŒ)

#### 7. ë©”ì‹œì§€ ìˆ˜ì •
**ì˜ˆìƒ ì‹œê°„**: 30ë¶„
**DB ë³€ê²½**: ìˆìŒ

```prisma
model ChatMessage {
  isEdited  Boolean   @default(false)
  editedAt  DateTime?
}
```

**êµ¬í˜„ ë‚´ìš©:**
- ë³¸ì¸ ë©”ì‹œì§€ ìˆ˜ì • ê°€ëŠ¥ (5ë¶„ ì´ë‚´)
- "(ìˆ˜ì •ë¨)" í‘œì‹œ

---

#### 8. ë¯¸ë””ì–´ ê°¤ëŸ¬ë¦¬
**ì˜ˆìƒ ì‹œê°„**: 1ì‹œê°„

**êµ¬í˜„ ë‚´ìš©:**
- ì±„íŒ…ë°© ë‚´ ëª¨ë“  ì‚¬ì§„/ë™ì˜ìƒ ëª¨ì•„ë³´ê¸°
- ê·¸ë¦¬ë“œ ë·°
- í´ë¦­ ì‹œ ë¼ì´íŠ¸ë°•ìŠ¤

---

#### 9. ë©”ì‹œì§€ ê²€ìƒ‰
**ì˜ˆìƒ ì‹œê°„**: 1ì‹œê°„

**êµ¬í˜„ ë‚´ìš©:**
- ì±„íŒ… ë‚´ìš© í…ìŠ¤íŠ¸ ê²€ìƒ‰
- ê²€ìƒ‰ ê²°ê³¼ í•˜ì´ë¼ì´íŠ¸
- ê²€ìƒ‰ ê²°ê³¼ í´ë¦­ â†’ í•´ë‹¹ ë©”ì‹œì§€ë¡œ ìŠ¤í¬ë¡¤

---

## ğŸš€ êµ¬í˜„ ìˆœì„œ (ê¶Œì¥)

### Week 1: í•„ìˆ˜ ê¸°ëŠ¥
1. âœ… **ë‚ ì§œ êµ¬ë¶„ì„ ** (30ë¶„)
2. âœ… **ë‹µì¥ ê¸°ëŠ¥** (1.5ì‹œê°„)
3. âœ… **ë©”ì‹œì§€ ìƒíƒœ** (1ì‹œê°„)

**â†’ ì´ 3ì‹œê°„, ê¸°ë³¸ ì±„íŒ… UX ì™„ì„±**

### Week 2: ê³ ê¸‰ ê¸°ëŠ¥
4. âœ… **ì½ìŒ í‘œì‹œ** (1.5ì‹œê°„)
5. âœ… **ì´ëª¨ì§€ ë¦¬ì•¡ì…˜** (1.5ì‹œê°„)

**â†’ ì´ 3ì‹œê°„, ì¹´í†¡ ìˆ˜ì¤€ ë„ë‹¬**

### Week 3: ë¯¸ë””ì–´ ê°•í™”
6. âœ… **ë™ì˜ìƒ + ì—¬ëŸ¬ íŒŒì¼** (2ì‹œê°„)
7. âœ… **ë¯¸ë””ì–´ ê°¤ëŸ¬ë¦¬** (1ì‹œê°„)

**â†’ ì´ 3ì‹œê°„, ì™“ì¸ ì•± ìˆ˜ì¤€ ë„ë‹¬**

---

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ ì¶”ê°€

### ìƒˆë¡œ ì„¤ì¹˜í•  íŒ¨í‚¤ì§€
```bash
npm install date-fns            # ë‚ ì§œ í¬ë§·íŒ…
npm install react-intersection-observer  # ì½ìŒ ì²˜ë¦¬
npm install cloudinary          # ë™ì˜ìƒ ì—…ë¡œë“œ
```

---

## ğŸ“ ë§ˆì´ê·¸ë ˆì´ì…˜ ìˆœì„œ

### 1ë‹¨ê³„: ë‹µì¥ ê¸°ëŠ¥
```bash
# schema.prisma ìˆ˜ì • í›„
npx prisma migrate dev --name add-reply-to-messages
```

### 2ë‹¨ê³„: ì½ìŒ í‘œì‹œ
```bash
npx prisma migrate dev --name add-message-reads
```

### 3ë‹¨ê³„: ì´ëª¨ì§€ ë¦¬ì•¡ì…˜
```bash
npx prisma migrate dev --name add-message-reactions
```

### 4ë‹¨ê³„: ë¯¸ë””ì–´ ì—…ë¡œë“œ
```bash
npx prisma migrate dev --name add-multiple-media
```

---

## ğŸ¨ UI/UX ê°œì„  í¬ì¸íŠ¸

### ì±„íŒ…ë°© ë ˆì´ì•„ì›ƒ ìµœì í™”
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ  ê°€ì¡± ì±„íŒ…      âš™ï¸  â”‚ â† í—¤ë” (ê³ ì •)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   2026ë…„ 1ì›” 7ì¼       â”‚ â† ë‚ ì§œ êµ¬ë¶„ì„ 
â”‚ ë©”ì‹œì§€ 1              â”‚
â”‚ ë©”ì‹œì§€ 2              â”‚
â”‚   ì˜¤ëŠ˜                â”‚
â”‚ ë©”ì‹œì§€ 3              â”‚
â”‚ ğŸ‘ 2  â¤ï¸ 1           â”‚ â† ë¦¬ì•¡ì…˜
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ë‹µì¥: ì—„ë§ˆ ë©”ì‹œì§€]    â”‚ â† ë‹µì¥ ë¯¸ë¦¬ë³´ê¸°
â”‚ ğŸ’¬ ë©”ì‹œì§€ ì…ë ¥...     â”‚
â”‚ ğŸ“+ ì‚¬ì§„/ë™ì˜ìƒ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ëª¨ë°”ì¼ ìµœì í™”
- í„°ì¹˜ ì œìŠ¤ì²˜ (ê¸¸ê²Œ ëˆ„ë¥´ê¸° â†’ ë©”ë‰´)
- ìŠ¤ì™€ì´í”„ â†’ ë‹µì¥
- ë”ë¸” íƒ­ â†’ ì¢‹ì•„ìš” ë¦¬ì•¡ì…˜

---

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. **ì½ìŒ ì²˜ë¦¬**: ë³¸ì¸ ë©”ì‹œì§€ëŠ” ì½ìŒ ì²˜ë¦¬ ë¶ˆê°€
2. **ë‹µì¥**: replyToId ìœ íš¨ì„± ê²€ì¦ (ê°™ì€ ì±„íŒ…ë°© ë©”ì‹œì§€ì¸ì§€)
3. **ë¦¬ì•¡ì…˜**: ì¤‘ë³µ ë¦¬ì•¡ì…˜ ë°©ì§€ (unique constraint)
4. **ë¯¸ë””ì–´ ì—…ë¡œë“œ**: Cloudinary Signed Upload ì‚¬ìš© (ë³´ì•ˆ ê°•í™”)

---

## ğŸ“Š ì„±ëŠ¥ ìµœì í™”

1. **ë©”ì‹œì§€ í˜ì´ì§€ë„¤ì´ì…˜**: ë¬´í•œ ìŠ¤í¬ë¡¤ (20ê°œì”©)
2. **ì´ë¯¸ì§€ ìµœì í™”**: Cloudinary transformation (resize, compress)
3. **Socket.IO**: ì±„íŒ…ë°©ë³„ room ë¶„ë¦¬ (broadcast ìµœì í™”)
4. **React Query**: staleTime ì„¤ì •ìœ¼ë¡œ ë¶ˆí•„ìš”í•œ refetch ë°©ì§€

---

## âœ… ì™„ë£Œ ê¸°ì¤€

### Phase 1 ì™„ë£Œ ì‹œ
- [x] ë‚ ì§œ êµ¬ë¶„ì„  í‘œì‹œ
- [x] ë©”ì‹œì§€ì— ë‹µì¥ ê°€ëŠ¥
- [x] ë‹µì¥ í´ë¦­ ì‹œ ì›ë³¸ìœ¼ë¡œ ì´ë™
- [x] ì „ì†¡ ìƒíƒœ í‘œì‹œ (ì „ì†¡ì¤‘/ì™„ë£Œ/ì‹¤íŒ¨)
- [x] ì‹¤íŒ¨ ì‹œ ì¬ì „ì†¡ ê°€ëŠ¥

### Phase 2 ì™„ë£Œ ì‹œ
- [x] ì½ìŒ í‘œì‹œ ("1", "2" ë“±)
- [x] ëª¨ë‘ ì½ìœ¼ë©´ í‘œì‹œ ì•ˆ í•¨
- [x] ì´ëª¨ì§€ ë¦¬ì•¡ì…˜ ì¶”ê°€/ì œê±°
- [x] ë¦¬ì•¡ì…˜ ê°œìˆ˜ í‘œì‹œ

### Phase 3 ì™„ë£Œ ì‹œ
- [x] ë™ì˜ìƒ ì²¨ë¶€ ê°€ëŠ¥
- [x] ì—¬ëŸ¬ íŒŒì¼ ë™ì‹œ ì²¨ë¶€ (ìµœëŒ€ 10ê°œ)
- [x] ë¯¸ë””ì–´ ê°¤ëŸ¬ë¦¬ ë·°
- [x] ë¯¸ë””ì–´ í¬ê¸° 100MBê¹Œì§€ ì§€ì›

---

**Last Updated**: 2026-01-08
**ë‹´ë‹¹**: Claude + User
